<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Creating Cohort Subset Definitions • CohortGenerator</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Creating Cohort Subset Definitions">
<link rel="stylesheet" type="text/css" href="extra.css">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CohortGenerator</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.12.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/CreatingCohortSubsetDefinitions.html">Creating Cohort Subset Definitions</a></li>
    <li><a class="dropdown-item" href="../articles/GeneratingCohorts.html">Generating Cohorts</a></li>
    <li><a class="dropdown-item" href="../articles/SamplingCohorts.html">Sampling Cohorts</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://ohdsi.github.io/Hades" aria-label="hadesLogo">hadesLogo</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/OHDSI/CohortGenerator/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Creating Cohort Subset Definitions</h1>
                        <h4 data-toc-skip class="author">James P.
Gilbert, Freddy Avila Cruz and Anthony G. Sena</h4>
            
            <h4 data-toc-skip class="date">2025-07-31</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/CohortGenerator/blob/main/vignettes/CreatingCohortSubsetDefinitions.Rmd" class="external-link"><code>vignettes/CreatingCohortSubsetDefinitions.Rmd</code></a></small>
      <div class="d-none name"><code>CreatingCohortSubsetDefinitions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This guide describes the process for creating cohort subsets using
<code>CohortGenerator</code>. OHDSI defines a cohort as <em>a set of
persons who satisfy one or more criteria for a duration of time</em> and
the aim with cohort subsets is to apply additional criteria to cohorts
to define more specific subgroups for use in various analyses. This is
done by defining a <strong>subset definition</strong> that includes one
or more <strong>subset operators</strong> to apply to cohorts that are a
part of your cohort definition set.</p>
<div class="section level3">
<h3 id="subset-operators">Subset Operators<a class="anchor" aria-label="anchor" href="#subset-operators"></a>
</h3>
<p>Cohort generator contains three types of subset operators that are
described below.</p>
<p><strong>Demographic subset operator</strong></p>
<p>The demographic subset operator allows you to subset a cohort by age,
gender, race or ethnicity.</p>
<p><strong>Limit subset operator</strong></p>
<p>The limit subset operator is designed to subset a cohort to limit
based on some time or ordinal criteria. For example, we might want to
consider the first event for a person in a cohort. We can use the limit
subset operator to limit a cohort based on prior observation time,
cohort duration or even a calendar start/end date.</p>
<p><strong>Cohort subset operator</strong></p>
<p>This type of operation allows you to subset a cohort to subjects
included in one or more other cohorts. As an example, we might be
interested in new users of metformin who have the indication of Type 2
diabetes. We can define this population using 2 cohorts: 1) new users of
metformin and 2) Type 2 diabetes patients. We can then use these 2
cohorts to define our target population where we describe “new users of
metformin who’s start date overlaps within a Type 2 diabetes episode.”
In this way, cohorts become reusable building blocks to create new
populations using existing cohort definitions.</p>
</div>
<div class="section level3">
<h3 id="subset-definition">Subset Definition<a class="anchor" aria-label="anchor" href="#subset-definition"></a>
</h3>
<p>Subset definitions are named sets of one or more operators (from
above) that can be applied to a set of one or more cohorts. Operators
can be sequentially chained within subset definitions and all outputs
are full cohorts that can be passed into to other analytical tasks.</p>
</div>
</div>
<div class="section level2">
<h2 id="creating-cohort-subset-definitions">Creating cohort subset definitions<a class="anchor" aria-label="anchor" href="#creating-cohort-subset-definitions"></a>
</h2>
<p>This section will provide an overview and some examples of how to
define a subset definition using the various operators.</p>
<div class="section level3">
<h3 id="cohort-definition-set">Cohort Definition Set<a class="anchor" aria-label="anchor" href="#cohort-definition-set"></a>
</h3>
<p>We will start by loading a cohort definition set with two cohorts for
this example:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jsonFilePath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"testdata"</span>, <span class="st">"CohortsToSubset.JSON"</span>, package <span class="op">=</span> <span class="st">"CohortGenerator"</span><span class="op">)</span></span>
<span><span class="va">cohortDefinitionSet</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="va">jsonFilePath</span><span class="op">)</span></span>
<span><span class="va">cohortDefinitionSet</span> <span class="op">&lt;-</span> <span class="va">cohortDefinitionSet</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cohortId</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cohortDefinitionSet</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="st">"cohortId"</span>, <span class="st">"cohortName"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">cohortId</th>
<th align="left">cohortName</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Celcoxib</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Ibuprofen</td>
</tr>
</tbody>
</table>
<p>We will use these two cohorts in the subsequent examples.</p>
</div>
<div class="section level3">
<h3 id="subset-operators-1">Subset operators<a class="anchor" aria-label="anchor" href="#subset-operators-1"></a>
</h3>
<p>In this section we will show you can create and use the various
subset operators to create different subset definitions using the two
cohorts in our example cohort definition set.</p>
<p><strong>Demographic Subset Operator</strong></p>
<p>Here is an example of a demographic subset operator called
<code>ageCriteria</code> that identifies cohort subjects between the
ages 20 - 50 years old.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ageCriteria</span> <span class="op">&lt;-</span> <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="../reference/createDemographicSubset.html">createDemographicSubset</a></span><span class="op">(</span></span>
<span>  ageMin <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  ageMax <span class="op">=</span> <span class="fl">50</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Limit Subset Operator</strong></p>
<p>This is an example of how we can create a limit subset operator
called <code>limitToLastEver</code> to identify the last cohort event
that happens between 1 January 2000 and 31 December 2008.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">limitToLastEver</span> <span class="op">&lt;-</span> <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="../reference/createLimitSubset.html">createLimitSubset</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Last event during 1 January 2000 and 31 December 2008"</span>,</span>
<span>  priorTime <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  followUpTime <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  limitTo <span class="op">=</span> <span class="st">"lastEver"</span>,</span>
<span>  calendarStartDate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2000-01-01"</span><span class="op">)</span>,</span>
<span>  calendarEndDate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2008-12-31"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Cohort Subset Operator</strong></p>
<p>The following example shows how we can identify patients that have an
ibuprofen event that starts during the target cohort start and end
date:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ibuprofenSubset</span> <span class="op">&lt;-</span> <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="../reference/createCohortSubset.html">createCohortSubset</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"ibuprofen exposure"</span>,</span>
<span>  cohortIds <span class="op">=</span> <span class="fl">2</span>, <span class="co"># Ibuprofen cohort</span></span>
<span>  cohortCombinationOperator <span class="op">=</span> <span class="st">"any"</span>, <span class="co"># Look for any Ibuprofen exposure</span></span>
<span>  negate <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># We want to include (not exclude) participants exposed to Ibuprofen,</span></span>
<span>  windows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="../reference/createSubsetCohortWindow.html">createSubsetCohortWindow</a></span><span class="op">(</span></span>
<span>      startDay <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      endDay <span class="op">=</span> <span class="fl">9999</span>,</span>
<span>      targetAnchor <span class="op">=</span> <span class="st">"cohortStart"</span>,</span>
<span>      subsetAnchor <span class="op">=</span> <span class="st">"cohortStart"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="../reference/createSubsetCohortWindow.html">createSubsetCohortWindow</a></span><span class="op">(</span></span>
<span>      startDay <span class="op">=</span> <span class="op">-</span><span class="fl">9999</span>,</span>
<span>      endDay <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      targetAnchor <span class="op">=</span> <span class="st">"cohortEnd"</span>,</span>
<span>      subsetAnchor <span class="op">=</span> <span class="st">"cohortStart"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In this subset, we use <strong>cohortId = 2</strong> to identify all
the subjects exposed to ibuprofen. The <strong>combinationOperation =
all</strong>, states that persons must exist in all of the
<code>cohortIds</code>. We define the <code>windows</code> to evaluate
the start/end date of the subset cohort (ibuprofen) relative to the
start/end date of the target cohort. The <code>windows</code> is defined
as:</p>
<p><strong>The subset cohort start date is on or after the target cohort
start date</strong></p>
<p><strong>AND</strong></p>
<p><strong>the subset cohort start date must end on or before the target
cohort end date</strong></p>
</div>
<div class="section level3">
<h3 id="create-the-subset-definition">Create the subset definition<a class="anchor" aria-label="anchor" href="#create-the-subset-definition"></a>
</h3>
<p>Now we can use one or more of the subset operators in a subset
definition. Here is how to create a subset definition for patients aged
between 20 to 50:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ageRequirementSubset</span> <span class="op">&lt;-</span> <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="../reference/createCohortSubsetDefinition.html">createCohortSubsetDefinition</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Patients 20 to 50 years old "</span>,</span>
<span>  definitionId <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  subsetOperators <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">ageCriteria</span></span>
<span>  <span class="op">)</span>,</span>
<span>  subsetCohortNameTemplate <span class="op">=</span> <span class="st">"@baseCohortName - @subsetDefinitionName"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can combine multiple subset operators in a single subset
definition. Here is how to create subset for patients aged 20-50 that
are exposed to ibuprofen at the start of the cohort and to extract the
last event from 1 January 2000 and 31 December 2008:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ibuprofenWCelcoxib</span> <span class="op">&lt;-</span> <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="../reference/createCohortSubsetDefinition.html">createCohortSubsetDefinition</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Aged 20-50 yrs, last ibuprofen exposure from 2000-2008"</span>,</span>
<span>  definitionId <span class="op">=</span> <span class="fl">11</span>, <span class="co"># Unique ID for this subset</span></span>
<span>  subsetOperators <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">ageCriteria</span>,</span>
<span>    <span class="va">ibuprofenSubset</span>,</span>
<span>    <span class="va">limitToLastEver</span></span>
<span>  <span class="op">)</span>,</span>
<span>  subsetCohortNameTemplate <span class="op">=</span> <span class="st">"@baseCohortName - @subsetDefinitionName"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adding-subsets-to-cohort-definition-set">Adding subsets to Cohort Definition Set<a class="anchor" aria-label="anchor" href="#adding-subsets-to-cohort-definition-set"></a>
</h3>
<p>Cohort subset definitions must be added to a cohort definition set to
generate these subsets using CohortGenerator. To do this, we use the
<code>addCohortSubsetDefinition</code> function to add the subset
definition to the cohort definition set. This function allows us to
specify the <code>targetCohortIds</code> that should receive the subset
definition and operators. Here we will apply the subset definitions to
the target cohort celecoxib (cohortId == 1).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cohortDefinitionSet</span> <span class="op">&lt;-</span> <span class="va">cohortDefinitionSet</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="../reference/addCohortSubsetDefinition.html">addCohortSubsetDefinition</a></span><span class="op">(</span><span class="va">ageRequirementSubset</span>, targetCohortIds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="../reference/addCohortSubsetDefinition.html">addCohortSubsetDefinition</a></span><span class="op">(</span><span class="va">ibuprofenWCelcoxib</span>, targetCohortIds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cohortDefinitionSet</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="st">"cohortId"</span>, <span class="st">"cohortName"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="12%">
<col width="88%">
</colgroup>
<thead><tr class="header">
<th align="right">cohortId</th>
<th align="left">cohortName</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Celcoxib</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">Ibuprofen</td>
</tr>
<tr class="odd">
<td align="right">1010</td>
<td align="left">Celcoxib - Patients 20 to 50 years old</td>
</tr>
<tr class="even">
<td align="right">1011</td>
<td align="left">Celcoxib - Aged 20-50 yrs, last ibuprofen exposure from
2000-2008</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="generating-subsets">Generating subsets<a class="anchor" aria-label="anchor" href="#generating-subsets"></a>
</h2>
<p>Next, we’ll use some test data included in the CohortGenerator
package is to demonstrate how generate subsets. We will begin by
creating an empty OMOP data model and populating it with person and drug
exposure entries. For reference, the script used to generate the test
data in <code>extras/PackageMaintenance.R</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">databaseFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".duckdb"</span><span class="op">)</span></span>
<span><span class="va">duckdbConnectionDetails</span> <span class="op">&lt;-</span> <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/createConnectionDetails.html" class="external-link">createConnectionDetails</a></span><span class="op">(</span></span>
<span>  dbms <span class="op">=</span> <span class="st">"duckdb"</span>,</span>
<span>  server <span class="op">=</span> <span class="va">databaseFile</span></span>
<span><span class="op">)</span></span>
<span><span class="va">resultsSchema</span> <span class="op">&lt;-</span> <span class="st">"main"</span></span>
<span><span class="va">connection</span> <span class="op">&lt;-</span> <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/connect.html" class="external-link">connect</a></span><span class="op">(</span><span class="va">duckdbConnectionDetails</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/insertTable.html" class="external-link">insertTable</a></span><span class="op">(</span></span>
<span>  connection <span class="op">=</span> <span class="va">connection</span>,</span>
<span>  databaseSchema <span class="op">=</span> <span class="va">resultsSchema</span>,</span>
<span>  tableName <span class="op">=</span> <span class="st">"person"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">omopCdmPerson</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Insert updated data into the 'drug_exposure' table</span></span>
<span><span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/insertTable.html" class="external-link">insertTable</a></span><span class="op">(</span></span>
<span>  connection <span class="op">=</span> <span class="va">connection</span>,</span>
<span>  databaseSchema <span class="op">=</span> <span class="va">resultsSchema</span>,</span>
<span>  tableName <span class="op">=</span> <span class="st">"drug_exposure"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">omopCdmDrugExposure</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can now use this sample data to generate the subsets:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cohortTableNames</span> <span class="op">&lt;-</span> <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="../reference/getCohortTableNames.html">getCohortTableNames</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="../reference/createCohortTables.html">createCohortTables</a></span><span class="op">(</span></span>
<span>  connection <span class="op">=</span> <span class="va">connection</span>,</span>
<span>  cohortDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  cohortTableNames <span class="op">=</span> <span class="va">cohortTableNames</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">### As subsets are a big side effect we need to be clear what was generated and have good naming conventions</span></span>
<span><span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="../reference/generateCohortSet.html">generateCohortSet</a></span><span class="op">(</span></span>
<span>  connection <span class="op">=</span> <span class="va">connection</span>,</span>
<span>  cdmDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  cohortDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  cohortTableNames <span class="op">=</span> <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="../reference/getCohortTableNames.html">getCohortTableNames</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  cohortDefinitionSet <span class="op">=</span> <span class="va">cohortDefinitionSet</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Cohort subset definitions can be run incrementally. In fact, if the
base cohort definition changes for any reason, any subsets will
automatically be re-executed when calling
<code>generateCohortSet</code>.</p>
<div class="section level3">
<h3 id="visualizing-subset-membership">Visualizing subset membership<a class="anchor" aria-label="anchor" href="#visualizing-subset-membership"></a>
</h3>
<p>In the graph below we show the 12 subjects who are in our sample data
set. Each subject’s graph is labeled with their subject ID, gender and
their age at index for the celecoxib exposure. The y-axis describes the
eras of time where a subject is a member of that cohort. The x-axis
represents the observation period for each subject.</p>
<p><img src="CreatingCohortSubsetDefinitions_files/figure-html/unnamed-chunk-10-1.png" width="960"></p>
<p>A subject may have 0 or more ibuprofen (cohort ID = 2) exposures.
When a subject is a member of one of the two subsets in our example,
they will have an era for the cohort ID on that row. For example,
subject 6 qualifies for cohort ID 1010 which identifies patients aged
20-50 years at the start of the celecoxib exposure. Similarly, subject
ID 2 qualifies for all subsets since they are aged 22 and also have an
ibuprofen exposure during their expsoure to celecoxib.</p>
</div>
</div>
<div class="section level2">
<h2 id="saving-and-loading-subset-definitions">Saving and loading subset definitions<a class="anchor" aria-label="anchor" href="#saving-and-loading-subset-definitions"></a>
</h2>
<div class="section level3">
<h3 id="saving-to-packagesdirectories">Saving to packages/directories<a class="anchor" aria-label="anchor" href="#saving-to-packagesdirectories"></a>
</h3>
<p>Saving applied subsets can automatically be added to a project using
<code>saveCohortDefinitionSet</code></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/saveCohortDefinitionSet.html">saveCohortDefinitionSet</a></span><span class="op">(</span><span class="va">cohortDefinitionSet</span>,</span>
<span>  subsetJsonFolder <span class="op">=</span> <span class="st">"&lt;path_to_my_subset_definition&gt;"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>loading is also achieved with <code>getCohortDefinitionSet</code></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cohortDefinitionSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getCohortDefinitionSet.html">getCohortDefinitionSet</a></span><span class="op">(</span></span>
<span>  subsetJsonFolder <span class="op">=</span> <span class="st">"&lt;path_to_my_subset_definition&gt;"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Any subset definitions should automatically be loaded and applied to
the cohort definition set.</p>
</div>
<div class="section level3">
<h3 id="writing-json-objects">Writing json objects<a class="anchor" aria-label="anchor" href="#writing-json-objects"></a>
</h3>
<p>Subset definitions can be converted to JSON objects as follows:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jsonDefinition</span> <span class="op">&lt;-</span> <span class="va">subsetDef</span><span class="op">$</span><span class="fu">toJSON</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>For the purpose of writing to disk we recommend the use of
<code>ParallelLogger</code> for consistency.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Save to a file</span></span>
<span><span class="fu">ParallelLogger</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/ParallelLogger/reference/saveSettingsToJson.html" class="external-link">saveSettingsToJson</a></span><span class="op">(</span><span class="va">subsetDef</span><span class="op">$</span><span class="fu">toList</span><span class="op">(</span><span class="op">)</span>, <span class="st">"subsetDefinition1.json"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Anthony Sena, Jamie Gilbert, Gowtham Rao, Freddy Avila Cruz, Martijn Schuemie.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
