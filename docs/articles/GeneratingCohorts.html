<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generating Cohorts • CohortGenerator</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Generating Cohorts">
<meta property="og:description" content="CohortGenerator">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">CohortGenerator</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/GeneratingCohorts.html">Generating Cohorts</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://ohdsi.github.io/Hades"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a>
</li>
<li>
  <a href="https://github.com/OHDSI/CohortGenerator/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="GeneratingCohorts_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Generating Cohorts</h1>
                        <h4 class="author">Anthony G. Sena and Martijn J. Schuemie</h4>
            
            <h4 class="date">2021-12-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/CohortGenerator/blob/master/vignettes/GeneratingCohorts.Rmd"><code>vignettes/GeneratingCohorts.Rmd</code></a></small>
      <div class="hidden name"><code>GeneratingCohorts.Rmd</code></div>

    </div>

    
    
<div id="guide-for-generating-cohorts-using-cohortgenerator" class="section level1">
<h1 class="hasAnchor">
<a href="#guide-for-generating-cohorts-using-cohortgenerator" class="anchor"></a>Guide for generating cohorts using CohortGenerator</h1>
<p>This guide will provide examples of using the CohortGenerator package to generate <a href="https://ohdsi.github.io/TheBookOfOhdsi/Cohorts.html">cohorts</a> in R. In this vignette, we will walk through the process of downloading cohorts from ATLAS and look at the options available for generating the cohorts.</p>
<div id="basic-example" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-example" class="anchor"></a>Basic Example</h2>
<div id="downloading-cohorts-from-atlas" class="section level3">
<h3 class="hasAnchor">
<a href="#downloading-cohorts-from-atlas" class="anchor"></a>Downloading cohorts from ATLAS</h3>
<p>We can create cohorts using <a href="https://github.com/OHDSI/Atlas">ATLAS</a> and download them for generation in R. To do this, we will use the <code>ROhdsiWebApi</code> package to download some cohort definitions to R:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A list of cohort IDs for use in this vignette</span>
<span class="va">cohortIds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1778211</span>,<span class="fl">1778212</span>,<span class="fl">1778213</span><span class="op">)</span>
<span class="co"># Get the SQL/JSON for the cohorts</span>
<span class="va">cohortDefinitionSet</span> <span class="op">&lt;-</span> <span class="fu">ROhdsiWebApi</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/ROhdsiWebApi/reference/exportCohortDefinitionSet.html">exportCohortDefinitionSet</a></span><span class="op">(</span>baseUrl <span class="op">=</span> <span class="va">baseUrl</span>,
                                                               cohortIds <span class="op">=</span> <span class="va">cohortIds</span><span class="op">)</span></code></pre></div>
<p>The code above connects to ATLAS’ WebAPI, retrieves all of the <code>cohortDefinitions</code> and then filters them based on the name to produce the <code>cohortsForGeneration</code> dataframe. <code>cohortsForGeneration</code> contains the list of cohort IDs to use for calling the function <code><a href="https://ohdsi.github.io/ROhdsiWebApi/reference/exportCohortDefinitionSet.html">ROhdsiWebApi::exportCohortDefinitionSet</a></code> to download the set of cohort definitions into <code>cohortDefinitionSet</code>. The cohort definition set data frame has the following columns:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">cohortDefinitionSet</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; [1] "atlasId"          "cohortId"         "cohortName"       "sql"             
#&gt; [5] "json"             "logicDescription" "generateStats"</code></pre>
<p>Here is how these columns are used:</p>
<ul>
<li>
<strong>atlasId</strong>: The ATLAS ID for the cohort. This provides linkage back to the ATLAS cohort definition</li>
<li>
<strong>cohortId</strong>: The cohortId will be the same as the atlasId upon export from ATLAS. We provide this column in case you’d like to alter the numbering scheme for your cohort definition set.</li>
<li>
<strong>cohortName</strong>: The name of the cohort in ATLAS.</li>
<li>
<strong>sql</strong>: The SQL used to construct the cohort.</li>
<li>
<strong>json</strong>: The <a href="https://github.com/OHDSI/circe-be">Circe</a> compliant JSON representation of the cohort definition</li>
<li>
<strong>logicDescription</strong>: The description of the cohort from ATLAS.</li>
</ul>
</div>
<div id="saving-in-a-study-package" class="section level3">
<h3 class="hasAnchor">
<a href="#saving-in-a-study-package" class="anchor"></a>Saving in a study package</h3>
<p>The <code>cohortDefintionSet</code> contains all of the details about each cohort that we would like to use for generation. As a best practice, we recommend that you embed these cohort details into a study package. To do this, we’ve created a function to save the cohort definition set to the file system:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/saveCohortDefinitionSet.html">saveCohortDefinitionSet</a></span><span class="op">(</span>cohortDefinitionSet <span class="op">=</span> <span class="va">cohortDefinitionSet</span>,
                        settingsFolder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">packageRoot</span>, <span class="st">"inst/settings"</span><span class="op">)</span>,
                        jsonFolder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">packageRoot</span>, <span class="st">"inst/cohorts"</span><span class="op">)</span>,
                        sqlFolder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">packageRoot</span>, <span class="st">"inst/sql/sql_server"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>By default, saving the cohort definition set will create the files under a folder called <code>inst</code> which is where resources for a study package will live. Under <code>inst</code> the following folders and files are created:</p>
<ul>
<li>
<strong>inst/settings/CohortsToCreate.csv</strong>: This will hold the list of cohorts found in the cohortDefinitionSet.</li>
<li>
<strong>inst/cohorts</strong>: This folder will contain a .json file per cohort definition.</li>
<li>
<strong>inst/sql/sql_server</strong>: This folder will contain a .sql file per cohort definition.</li>
</ul>
<p>Your study package can later re-construct the cohortDefinitionSet by reading in these resources into the data frame structure described earlier in this vignette.</p>
</div>
<div id="generating-cohorts" class="section level3">
<h3 class="hasAnchor">
<a href="#generating-cohorts" class="anchor"></a>Generating Cohorts</h3>
<p>Now that we have obtained the <code>cohortDefinitionSet</code> from ROhdsiWebApi, we’re ready to generate our cohorts against our OMOP CDM. In this example, we will use the <a href="https://github.com/OHDSI/Eunomia">Eunomia</a> data set as our CDM.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get the Eunomia connection details</span>
<span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu">Eunomia</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Eunomia/man/getEunomiaConnectionDetails.html">getEunomiaConnectionDetails</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># First get the cohort table names to use for this generation task</span>
<span class="va">cohortTableNames</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getCohortTableNames.html">getCohortTableNames</a></span><span class="op">(</span>cohortTable <span class="op">=</span> <span class="st">"cg_example"</span><span class="op">)</span>

<span class="co"># Next create the tables on the database</span>
<span class="fu"><a href="../reference/createCohortTables.html">createCohortTables</a></span><span class="op">(</span>connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,
                   cohortTableNames <span class="op">=</span> <span class="va">cohortTableNames</span>,
                   cohortDatabaseSchema <span class="op">=</span> <span class="st">"main"</span><span class="op">)</span>

<span class="co"># Generate the cohort set</span>
<span class="va">cohortsGenerated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateCohortSet.html">generateCohortSet</a></span><span class="op">(</span>connectionDetails<span class="op">=</span> <span class="va">connectionDetails</span>,
                                      cdmDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,
                                      cohortDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,
                                      cohortTableNames <span class="op">=</span> <span class="va">cohortTableNames</span>,
                                      cohortDefinitionSet <span class="op">=</span> <span class="va">cohortDefinitionSet</span><span class="op">)</span></code></pre></div>
<p>The code above starts by obtaining the <code>connectionDetails</code> from Eunomia. This is where you’ll likely want to substitute your own connection information. Next, we call <code>getCohortTableNames</code> to obtain a list of <code>cohortTableNames</code> that we’ll use for the generation process. We then call <code>createCohortTables</code> to create the cohort tables on the database server in the <code>cohortDatabaseSchema</code>. Once these tables are created, we use the function <code>generateCohortSet</code> to generate the <code>cohortDefintionSet</code>. When calling <code>generateCohortSet</code>, we must specify the schema that holds our CDM (<code>cdmDatabaseSchema</code>), the location of the <code>cohortDatabaseSchema</code> and <code>cohortTableNames</code> where the cohort(s) will be generated. We will cover the other parameters available in the <a href="#advancedOptions">Advanced Options</a> section.</p>
<p>If we’d like to see the results of the generation process, we can use the <code>getCohortCounts</code> method to query the cohort table for a summary of the persons and events for each cohort:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/getCohortCounts.html">getCohortCounts</a></span><span class="op">(</span>connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,
                cohortDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,
                cohortTable <span class="op">=</span> <span class="va">cohortTableNames</span><span class="op">$</span><span class="va">cohortTable</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; Connecting using SQLite driver</code></pre>
<pre><code>#&gt; Counting cohorts took 0.035 secs</code></pre>
<pre><code>#&gt;   cohortId cohortEntries cohortSubjects
#&gt; 1  1778211          1800           1800
#&gt; 2  1778212           569            569
#&gt; 3  1778213           266            266</code></pre>
</div>
</div>
<div id="advancedOptions" class="section level2">
<h2 class="hasAnchor">
<a href="#advancedOptions" class="anchor"></a>Advanced Options</h2>
<div id="cohort-statistics-inclusion-rule-statistics" class="section level3">
<h3 class="hasAnchor">
<a href="#cohort-statistics-inclusion-rule-statistics" class="anchor"></a>Cohort Statistics (Inclusion Rule Statistics)</h3>
<p>Cohorts defined in ATLAS may define one or more inclusion criteria as part of the cohort’s logic. As part of cohort generation, we may want to capture these cohort statistics for use in other packages. For example, <a href="https://ohdsi.github.io/CohortDiagnostics">CohortDiagnostics</a> has functionality that allows for review of inclusion rule statistics to understand how these rules may materialize between data sources. Here we will review how to generate cohorts with inclusion rule statistics and how to export these results for use by downstream packages such as CohortDiagnostics. Building on our basic example, let’s export the cohorts from WebAPI but this time indicate that we’d like to also include the code that <code>generatesStats</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get the cohorts and include the code to generate inclusion rule stats</span>
<span class="va">cohortDefinitionSet</span> <span class="op">&lt;-</span> <span class="fu">ROhdsiWebApi</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/ROhdsiWebApi/reference/exportCohortDefinitionSet.html">exportCohortDefinitionSet</a></span><span class="op">(</span>baseUrl <span class="op">=</span> <span class="va">baseUrl</span>,
                                                               cohortIds <span class="op">=</span> <span class="va">cohortIds</span>,
                                                               generateStats <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Next we’ll create the tables to store the cohort and the cohort statistics. Then we can generate the cohorts.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># First get the cohort table names to use for this generation task</span>
<span class="va">cohortTableNames</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getCohortTableNames.html">getCohortTableNames</a></span><span class="op">(</span>cohortTable <span class="op">=</span> <span class="st">"stats_example"</span><span class="op">)</span>

<span class="co"># Next create the tables on the database</span>
<span class="fu"><a href="../reference/createCohortTables.html">createCohortTables</a></span><span class="op">(</span>connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,
                   cohortTableNames <span class="op">=</span> <span class="va">cohortTableNames</span>,
                   cohortDatabaseSchema <span class="op">=</span> <span class="st">"main"</span><span class="op">)</span>

<span class="co"># We can then generate the cohorts the same way as before and it will use the </span>
<span class="co"># cohort statstics tables to store the results</span>
<span class="co"># Generate the cohort set</span>
<span class="fu"><a href="../reference/generateCohortSet.html">generateCohortSet</a></span><span class="op">(</span>connectionDetails<span class="op">=</span> <span class="va">connectionDetails</span>,
                  cdmDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,
                  cohortDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,
                  cohortTableNames <span class="op">=</span> <span class="va">cohortTableNames</span>,
                  cohortDefinitionSet <span class="op">=</span> <span class="va">cohortDefinitionSet</span><span class="op">)</span></code></pre></div>
<p>At this stage, your cohorts are generated and any cohort statistics are available in the cohort statistics tables. The next step is to export the results to the file system which is done using the code below:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/insertInclusionRuleNames.html">insertInclusionRuleNames</a></span><span class="op">(</span>connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,
                         cohortDefinitionSet <span class="op">=</span> <span class="va">cohortDefinitionSet</span>,
                         cohortDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,
                         cohortInclusionTable <span class="op">=</span> <span class="va">cohortTableNames</span><span class="op">$</span><span class="va">cohortInclusionTable</span><span class="op">)</span>

<span class="fu"><a href="../reference/exportCohortStatsTables.html">exportCohortStatsTables</a></span><span class="op">(</span>connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,
                        cohortDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,
                        cohortTableNames <span class="op">=</span> <span class="va">cohortTableNames</span>,
                        cohortStatisticsFolder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">someFolder</span>, <span class="st">"InclusionStats"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The code above performs two steps. First, we insert the inclusion rule names from the Circe expressions in the <code>cohortDefinitionSet</code>. This is important since these names are not automatically inserted into the database when generating the cohorts. Second, we export the cohort statistics to the file system which will write comma separated value (CSV) files per cohort statistic table in the <code>InclusionStats</code> folder.</p>
<p>Once you have exported your cohort statistics, you can optionally drop the statistics tables by using the following command:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/dropCohortStatsTables.html">dropCohortStatsTables</a></span><span class="op">(</span>connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,
                      cohortDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,
                      cohortTableNames <span class="op">=</span> <span class="va">cohortTableNames</span><span class="op">)</span></code></pre></div>
</div>
<div id="incremental-mode" class="section level3">
<h3 class="hasAnchor">
<a href="#incremental-mode" class="anchor"></a>Incremental Mode</h3>
<p>CohortGenerator provides an <code>incremental</code> option for some of its functions. The purpose of this <code>incremental</code> setting is to allow for the code to attempt to skip an operation if it has already completed it. For example, in the context of cohort generation we may want to keep track of cohorts that we have already generated against a source and skip it if we know the cohort definition has not changed. To illustrate incremental mode and explain how it works, we’ll continue along with our example from earlier.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a set of tables for this example</span>
<span class="va">cohortTableNames</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getCohortTableNames.html">getCohortTableNames</a></span><span class="op">(</span>cohortTable <span class="op">=</span> <span class="st">"cohort"</span><span class="op">)</span>
<span class="fu"><a href="../reference/createCohortTables.html">createCohortTables</a></span><span class="op">(</span>connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,
                   cohortTableNames <span class="op">=</span> <span class="va">cohortTableNames</span>,
                   cohortDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,
                   incremental <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>As expected, the code created the cohort tables as requested. Under the hood, since <code>incremental = TRUE</code> was set, the code did a check against the database to see if the tables already exist before creating them. To verify this, we can call the function again and check the results:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/createCohortTables.html">createCohortTables</a></span><span class="op">(</span>connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,
                   cohortTableNames <span class="op">=</span> <span class="va">cohortTableNames</span>,
                   cohortDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,
                   incremental <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; Connecting using SQLite driver</code></pre>
<pre><code>#&gt; Table "cohort" already exists and in incremental mode, so not recreating it.
#&gt; Table "cohort_inclusion" already exists and in incremental mode, so not recreating it.
#&gt; Table "cohort_inclusion_result" already exists and in incremental mode, so not recreating it.
#&gt; Table "cohort_inclusion_stats" already exists and in incremental mode, so not recreating it.
#&gt; Table "cohort_summary_stats" already exists and in incremental mode, so not recreating it.
#&gt; Table "cohort_censor_stats" already exists and in incremental mode, so not recreating it.</code></pre>
<p>The use of <code>incremental = TRUE</code> here allows for assurance that tables and results from previous runs are preserved. Next, we can generate our <code>cohortDefinitionSet</code> in incremental mode.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/generateCohortSet.html">generateCohortSet</a></span><span class="op">(</span>connectionDetails<span class="op">=</span> <span class="va">connectionDetails</span>,
                  cdmDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,
                  cohortDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,
                  cohortTableNames <span class="op">=</span> <span class="va">cohortTableNames</span>,
                  cohortDefinitionSet <span class="op">=</span> <span class="va">cohortDefinitionSet</span>,
                  incremental <span class="op">=</span> <span class="cn">TRUE</span>,
                  incrementalFolder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">someFolder</span>, <span class="st">"RecordKeeping"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Here we indicate that we are performing this operational incrementally by specifying <code>incremental = TRUE</code> and by specifying a folder for holding a record keeping file to track where cohorts are generated: <code>incrementalFolder = file.path(someFolder, "RecordKeeping")</code>. Once a cohort is generated in incremental mode, the cohort ID and a checksum of the cohort SQL are saved in the <code>incrementalFolder</code> in a file called <code>GeneratedCohorts.csv</code>. If we attempt to re-generate the same cohort set in incremental mode, <code>generateCohortSet</code> will inspect the SQL for each cohort in the <code>cohortDefinitionSet</code> and if the checksum of that cohort matches the checksum found in the <code>incrementalFolder</code> for the same cohort ID, the generation is skipped. To illustrate how this looks:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/generateCohortSet.html">generateCohortSet</a></span><span class="op">(</span>connectionDetails<span class="op">=</span> <span class="va">connectionDetails</span>,
                  cdmDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,
                  cohortDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,
                  cohortTableNames <span class="op">=</span> <span class="va">cohortTableNames</span>,
                  cohortDefinitionSet <span class="op">=</span> <span class="va">cohortDefinitionSet</span>,
                  incremental <span class="op">=</span> <span class="cn">TRUE</span>,
                  incrementalFolder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">someFolder</span>, <span class="st">"RecordKeeping"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; Connecting using SQLite driver</code></pre>
<pre><code>#&gt; Skipping cohortId = '1778211' because it is unchanged from earlier run
#&gt; Skipping cohortId = '1778212' because it is unchanged from earlier run
#&gt; Skipping cohortId = '1778213' because it is unchanged from earlier run
#&gt; Generating cohort set took 0.05 secs</code></pre>
<div id="potential-pitfalls-of-incremental-mode" class="section level4">
<h4 class="hasAnchor">
<a href="#potential-pitfalls-of-incremental-mode" class="anchor"></a>Potential Pitfalls of Incremental Mode</h4>
<p>Incremental mode makes some assumptions to provide a more flexible way to generate cohorts. These assumptions come with some risks that we would like to highlight:</p>
<ul>
<li>
<strong>Record keeping files</strong>: The incremental approach for cohort generation makes use of a record keeping file to check if a cohort has already been generated. It does <strong>not</strong> check the database to verify this so you need to take care and preserve the file system where you store the record keeping file. If the file is removed, CohortGenerator will simply repeat the cohort generation process.</li>
</ul>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Anthony Sena, Gowtham Rao, Martijn Schuemie.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
