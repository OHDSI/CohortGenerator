<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Creating Cohort Subset Definitions • CohortGenerator</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creating Cohort Subset Definitions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-dark" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CohortGenerator</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.11.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/CreatingCohortSubsetDefinitions.html">Creating Cohort Subset Definitions</a></li>
    <li><a class="dropdown-item" href="../articles/GeneratingCohorts.html">Generating Cohorts</a></li>
    <li><a class="dropdown-item" href="../articles/SamplingCohorts.html">Sampling Cohorts</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://ohdsi.github.io/Hades"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/OHDSI/CohortGenerator/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Creating Cohort Subset Definitions</h1>
                        <h4 data-toc-skip class="author">James P.
Gilbert and Anthony G. Sena</h4>
            
            <h4 data-toc-skip class="date">2024-09-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/CohortGenerator/blob/HEAD/vignettes/CreatingCohortSubsetDefinitions.Rmd" class="external-link"><code>vignettes/CreatingCohortSubsetDefinitions.Rmd</code></a></small>
      <div class="d-none name"><code>CreatingCohortSubsetDefinitions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This guide aims to describe the process of cohort subsetting using
<code>CohortGenerator</code>. The purpose of Cohort subsetting
operations is to allow the creation of common operations that can be
applied to generated cohorts in order to subset to different operations
in a consistent manner.</p>
</div>
<div class="section level2">
<h2 id="subset-definitions">Subset definitions<a class="anchor" aria-label="anchor" href="#subset-definitions"></a>
</h2>
<p>Subset definitions are named sets of operations that can be applied
to a set of one or more cohorts. The current operations that you can
apply to cohorts are:</p>
<ul>
<li>Limit subsets</li>
<li>Demographic subsets</li>
<li>Cohort subsetting</li>
</ul>
<p>Operations can be sequentially chained within <em>subset
definitions</em> and all outputs are considered full cohorts that can be
passed into to other packages as if they are cohorts designed in
packages</p>
<div class="section level3">
<h3 id="demographic-subset-operations">Demographic subset operations<a class="anchor" aria-label="anchor" href="#demographic-subset-operations"></a>
</h3>
<p>This subsetting process allows you to capture the age, race/ethnicity
gender within a cohort as subgroups. For example, “subset cohorts to
subjects that are male between the ages 1 and 5 years old”.</p>
</div>
<div class="section level3">
<h3 id="subsetting-to-other-cohorts">Subsetting to other cohorts<a class="anchor" aria-label="anchor" href="#subsetting-to-other-cohorts"></a>
</h3>
<p>This type of operation allows you to subset a cohort to only those
subjects included in one or more other cohorts</p>
</div>
</div>
<div class="section level2">
<h2 id="creating-cohort-subset-definitions">Creating cohort subset definitions<a class="anchor" aria-label="anchor" href="#creating-cohort-subset-definitions"></a>
</h2>
<div class="section level3">
<h3 id="defining-a-subset-definition">Defining a subset definition<a class="anchor" aria-label="anchor" href="#defining-a-subset-definition"></a>
</h3>
<p>First get a Cohort definition set:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cohortDefinitionSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getCohortDefinitionSet.html">getCohortDefinitionSet</a></span><span class="op">(</span></span>
<span>  settingsFileName <span class="op">=</span> <span class="st">"testdata/name/Cohorts.csv"</span>,</span>
<span>  jsonFolder <span class="op">=</span> <span class="st">"testdata/name/cohorts"</span>,</span>
<span>  sqlFolder <span class="op">=</span> <span class="st">"testdata/name/sql/sql_server"</span>,</span>
<span>  cohortFileNameFormat <span class="op">=</span> <span class="st">"%s"</span>,</span>
<span>  cohortFileNameValue <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cohortName"</span><span class="op">)</span>,</span>
<span>  packageName <span class="op">=</span> <span class="st">"CohortGenerator"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cohortDefinitionSet</span><span class="op">$</span><span class="va">cohortId</span> <span class="op">&lt;-</span> <span class="va">cohortDefinitionSet</span><span class="op">$</span><span class="va">cohortId</span> <span class="op">+</span> <span class="fl">1778210</span> <span class="co"># Match the cohort Ids taken from Atlas</span></span>
<span><span class="va">cohortIds</span> <span class="op">&lt;-</span> <span class="va">cohortDefinitionSet</span><span class="op">$</span><span class="va">cohortId</span></span>
<span><span class="va">cohortDefinitionSet</span><span class="op">$</span><span class="va">atlasId</span> <span class="op">&lt;-</span> <span class="va">cohortDefinitionSet</span><span class="op">$</span><span class="va">cohortId</span></span>
<span><span class="va">cohortDefinitionSet</span><span class="op">$</span><span class="va">logicDescription</span> <span class="op">&lt;-</span> <span class="st">""</span></span></code></pre></div>
<p>A definition can include different subset operations - these are
applied strictly in order:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example, we want to have a HTN cohort that starts any time prior to the index start</span></span>
<span><span class="co"># and the HTN cohort ends any time after the index start</span></span>
<span><span class="va">subsetDef</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCohortSubsetDefinition.html">createCohortSubsetDefinition</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Patients in cohort cohort 1778213 with 365 days prior observation"</span>,</span>
<span>  definitionId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  subsetOperators <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co"># here we are saying 'first subset to only those patients in cohort 1778213'</span></span>
<span>    <span class="fu"><a href="../reference/createCohortSubset.html">createCohortSubset</a></span><span class="op">(</span></span>
<span>      name <span class="op">=</span> <span class="st">"Subset to patients in cohort 1778213"</span>,</span>
<span>      <span class="co"># Note that this can be set to any id - if the</span></span>
<span>      <span class="co"># cohort is empty or doesn't exist this will not error</span></span>
<span>      cohortIds <span class="op">=</span> <span class="fl">1778213</span>,</span>
<span>      cohortCombinationOperator <span class="op">=</span> <span class="st">"any"</span>,</span>
<span>      negate <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      startWindow <span class="op">=</span> <span class="fu"><a href="../reference/createSubsetCohortWindow.html">createSubsetCohortWindow</a></span><span class="op">(</span></span>
<span>        startDay <span class="op">=</span> <span class="op">-</span><span class="fl">9999</span>,</span>
<span>        endDay <span class="op">=</span> <span class="fl">0</span>,</span>
<span>        targetAnchor <span class="op">=</span> <span class="st">"cohortStart"</span></span>
<span>      <span class="op">)</span>,</span>
<span>      endWindow <span class="op">=</span> <span class="fu"><a href="../reference/createSubsetCohortWindow.html">createSubsetCohortWindow</a></span><span class="op">(</span></span>
<span>        startDay <span class="op">=</span> <span class="fl">0</span>,</span>
<span>        endDay <span class="op">=</span> <span class="fl">9999</span>,</span>
<span>        targetAnchor <span class="op">=</span> <span class="st">"cohortStart"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span></span>
<span>    <span class="co"># Next, subset to only those with 365 days of prior observation</span></span>
<span>    <span class="fu"><a href="../reference/createLimitSubset.html">createLimitSubset</a></span><span class="op">(</span></span>
<span>      name <span class="op">=</span> <span class="st">"Observation of at least 365 days prior"</span>,</span>
<span>      priorTime <span class="op">=</span> <span class="fl">365</span>,</span>
<span>      followUpTime <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      limitTo <span class="op">=</span> <span class="st">"all"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="reusing-subset-operators-in-multiple-definitions">Reusing subset operators in multiple definitions<a class="anchor" aria-label="anchor" href="#reusing-subset-operators-in-multiple-definitions"></a>
</h3>
<p>Next we create a similar definition that also subsetOperators the
specified cohorts to require patients with specific demographic
criteria. We can do that by copying the subset operations from our first
definition and modifying them.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subsetOperations2</span> <span class="op">&lt;-</span> <span class="va">subsetDef</span><span class="op">$</span><span class="va">subsetOperators</span></span>
<span></span>
<span><span class="co"># subset to those between aged 18 an 64</span></span>
<span><span class="va">subsetOperations2</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/createDemographicSubset.html">createDemographicSubset</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"18 - 65"</span>,</span>
<span>    ageMin <span class="op">=</span> <span class="fl">18</span>,</span>
<span>    ageMax <span class="op">=</span> <span class="fl">64</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">subsetDef2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCohortSubsetDefinition.html">createCohortSubsetDefinition</a></span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"Patients in cohort 1778213 with 365 days prior obs, aged 18 - 64"</span>,</span>
<span>  definitionId <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  subsetOperators <span class="op">=</span> <span class="va">subsetOperations2</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="applying-subset-definitions-to-a-cohort-definition-set">Applying subset definitions to a cohort definition set<a class="anchor" aria-label="anchor" href="#applying-subset-definitions-to-a-cohort-definition-set"></a>
</h3>
<p>Next we need to add the subset definitions to the base cohort set.
This will automatically add identifiers and OHDSI SQL for the subset
cohorts as well as storing references for saving definition sets for
re-use.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cohortDefinitionSet</span> <span class="op">&lt;-</span> <span class="va">cohortDefinitionSet</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/addCohortSubsetDefinition.html">addCohortSubsetDefinition</a></span><span class="op">(</span><span class="va">subsetDef</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">cohortDefinitionSet</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cohortDefinitionSet</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cohortDefinitionSet</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"json"</span>, <span class="st">"sql"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="4%">
<col width="68%">
<col width="3%">
<col width="7%">
<col width="5%">
<col width="3%">
<col width="7%">
</colgroup>
<thead><tr>
<th align="right">cohortId</th>
<th align="left">cohortName</th>
<th align="right">atlasId</th>
<th align="left">logicDescription</th>
<th align="right">subsetParent</th>
<th align="left">isSubset</th>
<th align="right">subsetDefinitionId</th>
</tr></thead>
<tbody>
<tr>
<td align="right">1778211</td>
<td align="left">celecoxib</td>
<td align="right">1778211</td>
<td align="left"></td>
<td align="right">1778211</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
</tr>
<tr>
<td align="right">1778212</td>
<td align="left">celecoxibAge40</td>
<td align="right">1778212</td>
<td align="left"></td>
<td align="right">1778212</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
</tr>
<tr>
<td align="right">1778213</td>
<td align="left">celecoxibAge40Male</td>
<td align="right">1778213</td>
<td align="left"></td>
<td align="right">1778213</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
</tr>
<tr>
<td align="right">1778214</td>
<td align="left">celecoxibCensored</td>
<td align="right">1778214</td>
<td align="left"></td>
<td align="right">1778214</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
</tr>
<tr>
<td align="right">1778211001</td>
<td align="left">celecoxib - Patients in cohort cohort 1778213 with 365
days prior observation Subset to patients in cohort 1778213, Observation
of at least 365 days prior</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">1778211</td>
<td align="left">TRUE</td>
<td align="right">1</td>
</tr>
<tr>
<td align="right">1778212001</td>
<td align="left">celecoxibAge40 - Patients in cohort cohort 1778213 with
365 days prior observation Subset to patients in cohort 1778213,
Observation of at least 365 days prior</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">1778212</td>
<td align="left">TRUE</td>
<td align="right">1</td>
</tr>
<tr>
<td align="right">1778213001</td>
<td align="left">celecoxibAge40Male - Patients in cohort cohort 1778213
with 365 days prior observation Subset to patients in cohort 1778213,
Observation of at least 365 days prior</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">1778213</td>
<td align="left">TRUE</td>
<td align="right">1</td>
</tr>
<tr>
<td align="right">1778214001</td>
<td align="left">celecoxibCensored - Patients in cohort cohort 1778213
with 365 days prior observation Subset to patients in cohort 1778213,
Observation of at least 365 days prior</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">1778214</td>
<td align="left">TRUE</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>We can also apply a subset definition to only a limited number of
target cohorts as follows</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cohortDefinitionSet</span> <span class="op">&lt;-</span> <span class="va">cohortDefinitionSet</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/addCohortSubsetDefinition.html">addCohortSubsetDefinition</a></span><span class="op">(</span><span class="va">subsetDef2</span>, targetCohortIds <span class="op">=</span> <span class="fl">1778212</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">cohortDefinitionSet</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cohortDefinitionSet</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cohortDefinitionSet</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"json"</span>, <span class="st">"sql"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="4%">
<col width="68%">
<col width="3%">
<col width="6%">
<col width="5%">
<col width="3%">
<col width="7%">
</colgroup>
<thead><tr>
<th align="right">cohortId</th>
<th align="left">cohortName</th>
<th align="right">atlasId</th>
<th align="left">logicDescription</th>
<th align="right">subsetParent</th>
<th align="left">isSubset</th>
<th align="right">subsetDefinitionId</th>
</tr></thead>
<tbody>
<tr>
<td align="right">1778211</td>
<td align="left">celecoxib</td>
<td align="right">1778211</td>
<td align="left"></td>
<td align="right">1778211</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
</tr>
<tr>
<td align="right">1778212</td>
<td align="left">celecoxibAge40</td>
<td align="right">1778212</td>
<td align="left"></td>
<td align="right">1778212</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
</tr>
<tr>
<td align="right">1778213</td>
<td align="left">celecoxibAge40Male</td>
<td align="right">1778213</td>
<td align="left"></td>
<td align="right">1778213</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
</tr>
<tr>
<td align="right">1778214</td>
<td align="left">celecoxibCensored</td>
<td align="right">1778214</td>
<td align="left"></td>
<td align="right">1778214</td>
<td align="left">FALSE</td>
<td align="right">NA</td>
</tr>
<tr>
<td align="right">1778211001</td>
<td align="left">celecoxib - Patients in cohort cohort 1778213 with 365
days prior observation Subset to patients in cohort 1778213, Observation
of at least 365 days prior</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">1778211</td>
<td align="left">TRUE</td>
<td align="right">1</td>
</tr>
<tr>
<td align="right">1778212001</td>
<td align="left">celecoxibAge40 - Patients in cohort cohort 1778213 with
365 days prior observation Subset to patients in cohort 1778213,
Observation of at least 365 days prior</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">1778212</td>
<td align="left">TRUE</td>
<td align="right">1</td>
</tr>
<tr>
<td align="right">1778213001</td>
<td align="left">celecoxibAge40Male - Patients in cohort cohort 1778213
with 365 days prior observation Subset to patients in cohort 1778213,
Observation of at least 365 days prior</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">1778213</td>
<td align="left">TRUE</td>
<td align="right">1</td>
</tr>
<tr>
<td align="right">1778214001</td>
<td align="left">celecoxibCensored - Patients in cohort cohort 1778213
with 365 days prior observation Subset to patients in cohort 1778213,
Observation of at least 365 days prior</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">1778214</td>
<td align="left">TRUE</td>
<td align="right">1</td>
</tr>
<tr>
<td align="right">1778212002</td>
<td align="left">celecoxibAge40 - Patients in cohort 1778213 with 365
days prior obs, aged 18 - 64 Subset to patients in cohort 1778213,
Observation of at least 365 days prior, 18 - 65</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="right">1778212</td>
<td align="left">TRUE</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
<p>The <code>cohortDefinitionSet</code> data.frame now has some
additional columns:</p>
<pre><code>subsetParent, isSubset, subsetDefinitionId</code></pre>
<p><code>subsetParent</code> indicates the parent cohort. For standard
cohorts this will be their own ID. For out newly defined subsets, this
will be the base cohort.</p>
<p><code>subsetDefinitionId</code> displays the id of the subset applied
to the cohort.</p>
<p>In addition, the name of the cohort displayed in this table is
automatically generated from the base cohort name, the subset name and
the names defined for the subset operations applied in the subset
definition. As the number of resulting subsets can become very large, it
is crucial to choose human interpretable naming conventions. For
example, see the name of our first cohort and the resulting name of a
child subset:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Cohort Id:"</span>, <span class="va">cohortDefinitionSet</span><span class="op">$</span><span class="va">cohortId</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Name"</span>, <span class="va">cohortDefinitionSet</span><span class="op">$</span><span class="va">cohortName</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Cohort Id: 1778211</span></span>
<span><span class="co">#&gt; Name celecoxib</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Cohort Id:"</span>, <span class="va">cohortDefinitionSet</span><span class="op">$</span><span class="va">cohortId</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Subset Parent Id:"</span>, <span class="va">cohortDefinitionSet</span><span class="op">$</span><span class="va">subsetParent</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Name"</span>, <span class="va">cohortDefinitionSet</span><span class="op">$</span><span class="va">cohortName</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Cohort Id: 1778214</span></span>
<span><span class="co">#&gt; Subset Parent Id: 1778214</span></span>
<span><span class="co">#&gt; Name celecoxibCensored</span></span></code></pre>
<p>Note that when adding a subset definition to a cohort definition set,
the target cohort ids e.g (1778211, 1778212) must exist in the
<code>cohortDefinitionSet</code> and the output ids
(<code>1778211002</code>, <code>1778212003</code>) must be unique. As
with all cohorts, any cohorts with these ids will be deleted prior to
execution to prevent collisions. Note that the default expression for
output cohort ids is <code>targetId * 1000 + definitionId</code> this
may cause collisions that will cause
<code>addCohortSubsetDefinition</code> to error. This can be modified by
changing the <code>identifierExpression</code> parameter to
<code>createSubsetDefinition</code>. This expression should be defined
to guarantee uniqueness or adding the definition to a cohort definition
set will fail.</p>
</div>
</div>
<div class="section level2">
<h2 id="generating-subsets">Generating subsets<a class="anchor" aria-label="anchor" href="#generating-subsets"></a>
</h2>
<p>Executing CohortGenerator, we can now include the subset operations
when our cohorts are generated:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu">Eunomia</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Eunomia/man/getEunomiaConnectionDetails.html" class="external-link">getEunomiaConnectionDetails</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/createCohortTables.html">createCohortTables</a></span><span class="op">(</span></span>
<span>  connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,</span>
<span>  cohortDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  cohortTableNames <span class="op">=</span> <span class="fu"><a href="../reference/getCohortTableNames.html">getCohortTableNames</a></span><span class="op">(</span><span class="st">"my_cohort"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># ### As subsets are a big side effect we need to be clear what was generated and have good naming conventions</span></span>
<span><span class="va">generatedCohorts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generateCohortSet.html">generateCohortSet</a></span><span class="op">(</span></span>
<span>  connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,</span>
<span>  cdmDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  cohortDatabaseSchema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  cohortTableNames <span class="op">=</span> <span class="fu"><a href="../reference/getCohortTableNames.html">getCohortTableNames</a></span><span class="op">(</span><span class="st">"my_cohort"</span><span class="op">)</span>,</span>
<span>  cohortDefinitionSet <span class="op">=</span> <span class="va">cohortDefinitionSet</span>,</span>
<span>  incremental <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  incrementalFolder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">someFolder</span>, <span class="st">"RecordKeeping"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Cohort subset definitions can be run incrementally. In fact, if the
base cohort definition changes for any reason, any subsets will
automatically be re-executed when calling
<code>generateCohortSet</code>.</p>
</div>
<div class="section level2">
<h2 id="saving-and-loading-subset-definitions">Saving and loading subset definitions<a class="anchor" aria-label="anchor" href="#saving-and-loading-subset-definitions"></a>
</h2>
<div class="section level3">
<h3 id="saving-to-packagesdirectories">Saving to packages/directories<a class="anchor" aria-label="anchor" href="#saving-to-packagesdirectories"></a>
</h3>
<p>Saving applied subsets can automatically be added to a project using
<code>saveCohortDefinitionSet</code></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/saveCohortDefinitionSet.html">saveCohortDefinitionSet</a></span><span class="op">(</span><span class="va">cohortDefinitionSet</span>,</span>
<span>  subsetJsonFolder <span class="op">=</span> <span class="st">"&lt;path_to_my_subset_definition&gt;"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>loading is also achieved with <code>getCohortDefinitionSet</code></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cohortDefinitionSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getCohortDefinitionSet.html">getCohortDefinitionSet</a></span><span class="op">(</span></span>
<span>  subsetJsonFolder <span class="op">=</span> <span class="st">"&lt;path_to_my_subset_definition&gt;"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Any subset definitions should automatically be loaded and applied to
the cohort definition set.</p>
</div>
<div class="section level3">
<h3 id="writing-json-objects">Writing json objects<a class="anchor" aria-label="anchor" href="#writing-json-objects"></a>
</h3>
<p>Subset definitions can be converted to JSON objects as follows:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jsonDefinition</span> <span class="op">&lt;-</span> <span class="va">subsetDef</span><span class="op">$</span><span class="fu">toJSON</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>For the purpose of writing to disk we recommend the use of
<code>ParallelLogger</code> for consistency.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Save to a file</span></span>
<span><span class="fu">ParallelLogger</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/ParallelLogger/reference/saveSettingsToJson.html" class="external-link">saveSettingsToJson</a></span><span class="op">(</span><span class="va">subsetDef</span><span class="op">$</span><span class="fu">toList</span><span class="op">(</span><span class="op">)</span>, <span class="st">"subsetDefinition1.json"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="va">old</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Anthony Sena, Jamie Gilbert, Gowtham Rao, Martijn Schuemie.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
